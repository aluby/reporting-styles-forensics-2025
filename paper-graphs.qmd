---
title: "paper-graphs"
format: html
editor: visual
---

```{r}
# set up
library(ggplot2)
paper_theme <- theme_minimal(base_family = "Atkinson Hyperlegible", base_size = 16)
```

```{r}
#Simualations - Theta coverage by category system
ggplot(categories_per_run_repeated) +
  aes(x = category_system, y = theta_coverage) +
  geom_boxplot(fill = "darkgray") +
  labs(
    title = "Theta coverage by category system",
    x = "Category system",
    y = "Theta coverage"
  )
```

```{r}
# 95% credible interval on Hicklin - 3 category responses
response3_after_fitting <- read.csv("fitting_on_real_data/Hicklin_2025/Hicklin_3category_fitting.csv")
#theta coverage
ggplot(response3_after_fitting, aes(y = exID, x = theta_hat, color = ThetaContainsZero)) +
  geom_errorbarh(aes(xmin = theta_low, xmax = theta_high), height = 0.3) +
  geom_point( color = "black") +
  scale_color_manual(values = c("FALSE" = "purple", "TRUE" = "deeppink")) +
  labs(x = "95% Credible Interval", y = "Theta Estimates (Examiner Proficiency)") +
  theme_minimal() +
  theme(
    legend.position = "none",  
    panel.grid.major.y = element_blank(),
     panel.background = element_rect(fill = "transparent", color = NA),
    plot.background = element_rect(fill = "transparent", color = NA), 
    legend.background = element_rect(fill = "transparent", color = NA),
    legend.box.background = element_rect(fill = "transparent", color = NA)
  )

#beta coverage
ggplot(response3_after_fitting, aes(y = pairID, x = beta_hat, color = BetaContainsZero)) +
  geom_errorbarh(aes(xmin = beta_low, xmax = beta_high), height = 0.3) +
  geom_point( color = "black") +
  scale_color_manual(values = c("FALSE" = "purple", "TRUE" = "deeppink")) +
  labs(x = "95% Credible Interval", y = "Beta Estimates (Item difficulty)") +
  theme_minimal() +
  theme(
    legend.position = "none",  
    panel.grid.major.y = element_blank(),
     panel.background = element_rect(fill = "transparent", color = NA),
    plot.background = element_rect(fill = "transparent", color = NA), 
    legend.background = element_rect(fill = "transparent", color = NA),
    legend.box.background = element_rect(fill = "transparent", color = NA)
  )
```

```{r}
# Ridgeplot of beta estimates by conclusion category

final_ridgeplot <- Hicklin |>
  drop_na(response5) |>
  left_join(ranef(hicklin_brms_model)$pairID |>
    as_tibble() |> 
    rownames_to_column(var = "pairID") |>
      mutate(pairID = as.numeric(pairID))) |> 
  mutate(
    beta_adj = `Estimate.Intercept` + 4.58*as.numeric(ground_truth == "N")
  ) |>
  ggplot() + 
  geom_density_ridges(aes(x = beta_adj, y = as.factor(response5), fill = as.factor(response5))) +
  scale_fill_viridis_d(option = "plasma", end = 0.8) +
  scale_y_discrete(labels=c("5" = "Exclusion", "4" = "Lean Exclusion",
                             "3" = "Inconclusive", "2" = "Lean Identification", "1" = "Identification")) +
  theme(
    legend.position = "none",  
    panel.grid.major.y = element_blank(),
     panel.background = element_rect(fill = "transparent", color = NA),
    plot.background = element_rect(fill = "transparent", color = NA), 
    legend.background = element_rect(fill = "transparent", color = NA),
    legend.box.background = element_rect(fill = "transparent", color = NA)
  ) +
  paper_theme +
     theme(legend.position = "none") +
  labs( x = "Beta Estimates", y = "", title = "Distribution of Beta Estimates for Each 
Conclusion Type", subtitle = "Only Non-mated Image Pairs")

ggsave("ridgeplot.png", final_ridgeplot)
```

```{r}
# posterior predictive check graphs - can plug in any brms model
library(bayesplot)
color_scheme_set("purple")
pp_check(hicklin_brms, type = "bars_grouped", group = "pairID", stat = "median" )
```

```{r}
# comparison plot of betas from Busey's model and from our model

# models ran to get the estimates from
hicklin_brms <- Hicklin %>% 
  mutate(
        "ds" = case_when(
      ground_truth == "M" ~ 0,
      ground_truth == "N" ~ 1
  )) %>% 
  brm(
    formula = response5 ~ ds + (1|pairID) + (1|exID),
    data = Hicklin,
  family = cumulative(probit),
  chains = 4,
  iter = 2000,
  seed = 6127,
  cores = 4
  )

hicklin_brms__notheta <- brm(
  formula = response5 ~ (1 | pairID),
  data = Hicklin,
  family = cumulative(probit),
  chains = 4,
  iter = 2000,
  seed = 6127,
  cores = 4
)

# need to take out NAs from the original Hicklin data set so that the image pairs line up to their correct estimates when we join the data sets together
hicklin_item_lookup <- Hicklin |>
  group_by(pairID) |>
  summarize(
    ground_truth = first(ground_truth)
  ) |>
  left_join( Hicklin |>
  drop_na(response3) |>
  group_by(pairID) |>
  summarize(
    ground_truth = first(ground_truth)
  ) |>
  ungroup() |>
  mutate(
    new_pairID = 1:n()
  ))

hicklin_compare <- ranef(hicklin_brms_model)$pairID %>% as.tibble() %>% 
  mutate(
    "pairID" = row_number()
  )
hicklin_compare2 <- ranef(hicklin_brms__notheta)$pairID %>% as.tibble() %>% 
  mutate(
    "pairID" = row_number()
  )
  
hicklin_busey_comparison <- hicklin_compare %>% 
  left_join(hicklin_compare2, by = "pairID") %>% 
  left_join(hicklin_item_lookup, by = c("pairID" = "new_pairID"))

no_theta_comparison_plot <- ggplot(hicklin_busey_comparison) +
  geom_point(aes(x = Estimate.Intercept.y, y = Estimate.Intercept.x, color = ground_truth)) +
  scale_color_viridis_d(option = "plasma", end = 0.8, labels = 
                          c("M" = "Mated",
                            "N" = "Non-Mated")) +
  labs(x = "No Theta Model Beta Estimates", y = "Our Model Beta Estimates", title = "No Theta Model Estimates Vs. 
       Theta Model Estimates", color = "Ground Truth") +
  paper_theme 
  
ggsave("no_theta_comparison_plot.png", no_theta_comparison_plot)

```
